(this["webpackJsonpnative-chat"]=this["webpackJsonpnative-chat"]||[]).push([[0],{10:function(e,t,n){},12:function(e,t,n){"use strict";n.r(t);var a,s=n(1),c=n.n(s),r=n(5),u=n.n(r),o=(n(10),n(2)),l=function(e){var t=Object(s.useState)(""),n=Object(o.a)(t,2),a=n[0],c=n[1],r=Object(s.useCallback)((function(e){var t=e.target.value;return c(t)}),[]),u=Object(s.useCallback)((function(){(a||"").trim()&&(e(a),c(""))}),[e,a]),l=Object(s.useCallback)((function(e){"Enter"===e.key&&u()}),[u]);return{value:a,handleChange:r,handleEnterDown:l,handleSetValue:u}},i=n(0),j=function(e){var t=e.onEnter,n=Object(s.useRef)(null);Object(s.useLayoutEffect)((function(){n.current.focus()}),[n]);var a=Object(s.useCallback)((function(){return n.current.focus()}),[n]),c=l(t),r=c.value,u=c.handleChange,o=c.handleEnterDown,j=c.handleSetValue;return Object(i.jsx)("div",{className:"h-screen bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500 flex justify-center items-center",onClick:a,children:Object(i.jsxs)("div",{children:[Object(i.jsx)("h4",{className:"text-white text-center mb-2",children:"What's your nickname?"}),Object(i.jsx)("input",{type:"text",ref:n,className:"text-center w-full mb-2 text-lg focus:outline-none",value:r,onChange:u,onKeyDown:o}),Object(i.jsx)("button",{className:"from-gray-200 w-full bg-white px-2",onClick:j,children:"Join"})]})})},f=function(e){var t=e.messages,n=e.className,a=void 0===n?"":n,c=Object(s.useRef)(null);return Object(s.useLayoutEffect)((function(){c.current.scrollIntoView({behavior:"smooth"})}),[c,t]),Object(i.jsxs)("ul",{className:"flex flex-col w-full p-2 ".concat(a),children:[t.map((function(e,t){return Object(i.jsx)("li",{children:Object(i.jsx)(e,{})},t)})),Object(i.jsx)("li",{ref:c})]})},b=function(e){var t=e.onEnter,n=e.onTyping,a=e.className,c=void 0===a?"":a,r=l(t),u=r.value,o=r.handleChange,j=r.handleEnterDown,f=r.handleSetValue,b=Object(s.useRef)(null),p=Object(s.useRef)({lastTyping:0,isTyping:!1});Object(s.useLayoutEffect)((function(){var e;return null===(e=b.current)||void 0===e?void 0:e.focus()}),[b]);var m=Object(s.useCallback)((function(){p.current.lastTyping=(new Date).getTime(),p.current.isTyping||(p.current.isTyping=!0,n(!0)),setTimeout((function(){(new Date).getTime()-p.current.lastTyping>=400&&p.current.isTyping&&(p.current.isTyping=!1,n(!1))}),400)}),[n]);return Object(i.jsxs)("footer",{className:"flex w-full h-12 ".concat(c),children:[Object(i.jsx)("input",{type:"text",ref:b,className:"w-full h-full mr-2 focus:outline-none p-2",onChange:o,onKeyDown:j,onInput:m,value:u,placeholder:"Type here..."}),Object(i.jsx)("button",{className:"from-gray-200 bg-white px-2",onClick:f,children:"Send"})]})},p=n(3),m=function(e){var t=e.text,n=e.className,a=void 0===n?"":n;return Object(i.jsx)("p",{className:"text-gray-400 text-center ".concat(a),children:t})},O=function(e){var t=e.nickname,n=e.isTyping,a=e.message,s=e.nicknameColor;return n||a?Object(i.jsxs)("div",{className:"",children:[Object(i.jsxs)("span",{className:"font-bold text-xl mr-2",style:{color:s},children:[t,":"]}),n?Object(i.jsx)("span",{children:"is typing..."}):Object(i.jsx)("span",{className:"break-words",children:a})]}):null};!function(e){e.ADD_USER="add user",e.LOGIN="login",e.USER_JOINED="user joined",e.USER_LEFT="user left",e.TYPING="typing",e.STOP_TYPING="stop typing",e.NEW_MESSAGE="new message"}(a||(a={}));var d=function(e){var t=e.type,n=e.payload;return"42".concat(JSON.stringify([t,n]))},h={colors:{},typings:{},messages:[]},g=function(e,t){var n=t.type,s=t.payload;switch(n){case a.LOGIN:var c=s.numUsers;return Object(p.a)(e,(function(e){return e.messages.push((function(){return Object(i.jsx)(m,{text:"Welcome to Very Native Socket Chat"})})),e.messages.push((function(){return Object(i.jsx)(m,{text:"there are ".concat(c," participants")})})),e}));case a.USER_JOINED:case a.USER_LEFT:return Object(p.a)(e,(function(e){var t=s,c=t.username,r=t.numUsers;return e.messages.push((function(){return Object(i.jsx)(m,{text:"".concat(c," ").concat(n===a.USER_JOINED?"joined":"left")})})),e.messages.push((function(){return Object(i.jsx)(m,{text:"there are ".concat(r," participants")})})),e}));case a.TYPING:case a.NEW_MESSAGE:var r=s,u=r.username,o=r.message;return Object(p.a)(e,(function(t){var s=e.colors[u];if(s||(t.colors[u]=s="#"+((1<<24)*Math.random()|0).toString(16)),n===a.NEW_MESSAGE)t.messages.push((function(){return Object(i.jsx)(O,{nickname:u,message:o,nicknameColor:s})}));else{var c=function(){return Object(i.jsx)(O,{nickname:u,nicknameColor:s,isTyping:!0})};t.typings[u]=c,t.messages.push(c)}return t}));case a.STOP_TYPING:var l=s.username;return Object(p.a)(e,(function(t){return t.messages=e.messages.filter((function(t){return t!==e.typings[l]})),t}));default:return e}},y=function(e,t){var n=Object(s.useState)(null),c=Object(o.a)(n,2),r=c[0],u=c[1],l=Object(s.useReducer)(g,h),i=Object(o.a)(l,2),j=i[0],f=i[1];return Object(s.useEffect)((function(){if(e){var n=new WebSocket(t);u(n),n.onopen=function(){n.send(d({type:a.ADD_USER,payload:e}))},n.onmessage=function(e){var t=function(e){var t=e.split("42"),n=Object(o.a)(t,2)[1];return n&&JSON.parse(n)}(e.data);if(t){var n=Object(o.a)(t,2),a=n[0],s=n[1];f({type:a,payload:s})}};var s=setInterval((function(){return n.send("2")}),2e4);return function(){n.close(1e3),clearInterval(s)}}}),[e,t]),{state:j,handleCreateMessage:Object(s.useCallback)((function(t){null===r||void 0===r||r.send(d({type:a.NEW_MESSAGE,payload:t})),f({type:a.NEW_MESSAGE,payload:{message:t,username:e}})}),[r,e]),handleTyping:Object(s.useCallback)((function(t){return null===r||void 0===r?void 0:r.send(d({type:t?a.TYPING:a.STOP_TYPING,payload:{username:e}}))}),[r,e])}},v=function(){var e=Object(s.useState)(""),t=Object(o.a)(e,2),n=t[0],a=t[1],c=y(n,"wss://socketio-chat-h9jt.herokuapp.com/socket.io/?EIO=3&transport=websocket"),r=c.state.messages,u=c.handleCreateMessage,l=c.handleTyping;return n?Object(i.jsxs)("main",{className:"h-screen w-full flex flex-col",children:[Object(i.jsx)(f,{messages:r,className:"h-full overflow-auto"}),Object(i.jsx)(b,{onEnter:u,onTyping:l,className:"p-2 bg-gray-900"})]}):Object(i.jsx)(j,{onEnter:a})};var x=function(){return Object(i.jsx)(v,{})};u.a.render(Object(i.jsx)(c.a.StrictMode,{children:Object(i.jsx)(x,{})}),document.getElementById("root"))}},[[12,1,2]]]);
//# sourceMappingURL=main.de789adb.chunk.js.map