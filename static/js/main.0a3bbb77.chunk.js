(this["webpackJsonpnative-chat"]=this["webpackJsonpnative-chat"]||[]).push([[0],{10:function(e,t,n){},12:function(e,t,n){"use strict";n.r(t);var s,a=n(1),c=n.n(a),r=n(5),u=n.n(r),o=(n(10),n(2)),i=function(e){var t=Object(a.useState)(""),n=Object(o.a)(t,2),s=n[0],c=n[1],r=Object(a.useCallback)((function(e){var t=e.target.value;return c(t)}),[]),u=Object(a.useCallback)((function(t){"Enter"===t.key&&(s||"").trim()&&(e(s),c(""))}),[e,s]);return{value:s,handleChange:r,handleEnterDown:u}},l=n(0),j=function(e){var t=e.onEnter,n=Object(a.useRef)(null);Object(a.useLayoutEffect)((function(){n.current.focus()}),[n]);var s=Object(a.useCallback)((function(){return n.current.focus()}),[n]),c=i(t),r=c.value,u=c.handleChange,o=c.handleEnterDown;return Object(l.jsx)("div",{className:"h-screen bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500 flex justify-center items-center",onClick:s,children:Object(l.jsxs)("div",{children:[Object(l.jsx)("h4",{className:"text-white mb-2",children:"What's your nickname?"}),Object(l.jsx)("input",{type:"text",ref:n,className:"text-center text-lg focus:outline-none",value:r,onChange:u,onKeyDown:o})]})})},f=function(e){var t=e.messages,n=e.className,s=void 0===n?"":n,c=Object(a.useRef)(null);return Object(a.useLayoutEffect)((function(){c.current.scrollIntoView({behavior:"smooth"})}),[c,t]),Object(l.jsxs)("ul",{className:"flex flex-col w-full p-2 ".concat(s),children:[t.map((function(e,t){return Object(l.jsx)("li",{children:Object(l.jsx)(e,{})},t)})),Object(l.jsx)("li",{ref:c})]})},b=function(e){var t=e.onEnter,n=e.onTyping,s=e.className,c=void 0===s?"":s,r=i(t),u=r.value,o=r.handleChange,j=r.handleEnterDown,f=Object(a.useRef)(null),b=Object(a.useRef)({lastTyping:0,isTyping:!1});Object(a.useLayoutEffect)((function(){var e;return null===(e=f.current)||void 0===e?void 0:e.focus()}),[f]);var p=Object(a.useCallback)((function(){b.current.lastTyping=(new Date).getTime(),b.current.isTyping||(b.current.isTyping=!0,n(!0)),setTimeout((function(){(new Date).getTime()-b.current.lastTyping>=400&&b.current.isTyping&&(b.current.isTyping=!1,n(!1))}),400)}),[n]);return Object(l.jsx)("footer",{className:"flex w-full h-12 ".concat(c),children:Object(l.jsx)("input",{type:"text",ref:f,className:"w-full h-full focus:outline-none p-2",onChange:o,onKeyDown:j,onInput:p,value:u,placeholder:"Type here..."})})},p=n(3),O=function(e){var t=e.text,n=e.className,s=void 0===n?"":n;return Object(l.jsx)("p",{className:"text-gray-400 text-center ".concat(s),children:t})},m=function(e){var t=e.nickname,n=e.isTyping,s=e.message,a=e.nicknameColor;return n||s?Object(l.jsxs)("div",{className:"",children:[Object(l.jsxs)("span",{className:"font-bold text-xl mr-2",style:{color:a},children:[t,":"]}),n?Object(l.jsx)("span",{children:"is typing..."}):Object(l.jsx)("span",{className:"break-words",children:s})]}):null};!function(e){e.ADD_USER="add user",e.LOGIN="login",e.USER_JOINED="user joined",e.USER_LEFT="user left",e.TYPING="typing",e.STOP_TYPING="stop typing",e.NEW_MESSAGE="new message"}(s||(s={}));var d=function(e){var t=e.type,n=e.payload;return"42".concat(JSON.stringify([t,n]))},h={colors:{},typings:{},messages:[]},g=function(e,t){var n=t.type,a=t.payload;switch(n){case s.LOGIN:var c=a.numUsers;return Object(p.a)(e,(function(e){return e.messages.push((function(){return Object(l.jsx)(O,{text:"Welcome to Very Native Socket Chat"})})),e.messages.push((function(){return Object(l.jsx)(O,{text:"there are ".concat(c," participants")})})),e}));case s.USER_JOINED:case s.USER_LEFT:return Object(p.a)(e,(function(e){var t=a,c=t.username,r=t.numUsers;return e.messages.push((function(){return Object(l.jsx)(O,{text:"".concat(c," ").concat(n===s.USER_JOINED?"joined":"left")})})),e.messages.push((function(){return Object(l.jsx)(O,{text:"there are ".concat(r," participants")})})),e}));case s.TYPING:case s.NEW_MESSAGE:var r=a,u=r.username,o=r.message;return Object(p.a)(e,(function(t){var a=e.colors[u];if(a||(t.colors[u]=a="#"+((1<<24)*Math.random()|0).toString(16)),n===s.NEW_MESSAGE)t.messages.push((function(){return Object(l.jsx)(m,{nickname:u,message:o,nicknameColor:a})}));else{var c=function(){return Object(l.jsx)(m,{nickname:u,nicknameColor:a,isTyping:!0})};t.typings[u]=c,t.messages.push(c)}return t}));case s.STOP_TYPING:var i=a.username;return Object(p.a)(e,(function(t){return t.messages=e.messages.filter((function(t){return t!==e.typings[i]})),t}));default:return e}},v=function(e,t){var n=Object(a.useState)(null),c=Object(o.a)(n,2),r=c[0],u=c[1],i=Object(a.useReducer)(g,h),l=Object(o.a)(i,2),j=l[0],f=l[1];return Object(a.useEffect)((function(){if(e){var n=new WebSocket(t);u(n),n.onopen=function(){n.send(d({type:s.ADD_USER,payload:e}))},n.onmessage=function(e){var t=function(e){var t=e.split("42"),n=Object(o.a)(t,2)[1];return n&&JSON.parse(n)}(e.data);if(t){var n=Object(o.a)(t,2),s=n[0],a=n[1];f({type:s,payload:a})}};var a=setInterval((function(){return n.send("2")}),2e4);return function(){n.close(1e3),clearInterval(a)}}}),[e,t]),{state:j,handleCreateMessage:Object(a.useCallback)((function(t){null===r||void 0===r||r.send(d({type:s.NEW_MESSAGE,payload:t})),f({type:s.NEW_MESSAGE,payload:{message:t,username:e}})}),[r,e]),handleTyping:Object(a.useCallback)((function(t){return null===r||void 0===r?void 0:r.send(d({type:t?s.TYPING:s.STOP_TYPING,payload:{username:e}}))}),[r,e])}},y=function(){var e=Object(a.useState)(""),t=Object(o.a)(e,2),n=t[0],s=t[1],c=v(n,"wss://socketio-chat-h9jt.herokuapp.com/socket.io/?EIO=3&transport=websocket"),r=c.state.messages,u=c.handleCreateMessage,i=c.handleTyping;return n?Object(l.jsxs)("main",{className:"h-screen w-full flex flex-col",children:[Object(l.jsx)(f,{messages:r,className:"h-full overflow-auto"}),Object(l.jsx)(b,{onEnter:u,onTyping:i,className:"p-2 bg-gray-900"})]}):Object(l.jsx)(j,{onEnter:s})};var x=function(){return Object(l.jsx)(y,{})};u.a.render(Object(l.jsx)(c.a.StrictMode,{children:Object(l.jsx)(x,{})}),document.getElementById("root"))}},[[12,1,2]]]);
//# sourceMappingURL=main.0a3bbb77.chunk.js.map